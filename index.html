<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vending Machine Profit Model - Bright.Blue vs Selecta</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 1.8em;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      font-weight: 600;
      color: #555;
      margin-bottom: 5px;
      font-size: 0.9em;
    }

    .input-group input {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .table-container {
      overflow-x: auto;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95em;
    }

    th {
      background: #667eea;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    tr:hover {
      background: #f5f5f5;
    }

    .number {
      text-align: right;
      font-family: 'Courier New', monospace;
    }

    .positive {
      color: #4caf50;
      font-weight: 600;
    }

    .negative {
      color: #f44336;
      font-weight: 600;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    /* Floating summary at the top */
    .summary-cards.summary-fixed {
      position: fixed;
      top: 0;
      z-index: 1000;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      /* ensure the banner itself paints the background instead of showing container's white */
      backdrop-filter: none;
    }

    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .summary-card h3 {
      font-size: 1.2em;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .summary-value {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .summary-detail {
      font-size: 0.9em;
      opacity: 0.8;
    }

    .btn-calculate {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.1em;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s;
      display: block;
      margin: 30px auto;
    }

    .btn-calculate:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .note {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
    }

    .audit-table {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }

    .audit-table h4 {
      color: #495057;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .formula {
      background: #fff;
      border: 1px solid #dee2e6;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      margin: 10px 0;
      color: #495057;
    }

    .calculation-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .calc-box {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
    }

    .calc-box h5 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .calc-line {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .calc-line:last-child {
      border-bottom: none;
      font-weight: bold;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 2px solid #667eea;
    }

    /* Mobile responsive styles */
    @media (max-width: 768px) {
      body {
        padding: 10px; /* Reduce background gap on mobile */
      }

      .container {
        border-radius: 15px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .content {
        padding: 20px;
      }

      /* Smaller summary cards on mobile */
      .summary-cards {
        grid-template-columns: 1fr; /* Stack cards vertically */
        gap: 10px;
      }

      .summary-cards.summary-fixed {
        padding: 10px 15px !important; /* Smaller padding when fixed */
      }

      .summary-card {
        padding: 15px; /* Reduced from 25px */
      }

      .summary-card h3 {
        font-size: 1em; /* Reduced from 1.2em */
        margin-bottom: 10px;
      }

      .summary-value {
        font-size: 1.8em; /* Reduced from 2.5em */
        margin-bottom: 5px;
      }

      .summary-detail {
        font-size: 0.85em; /* Reduced from 0.9em */
      }

      /* Adjust grid layouts for mobile */
      .grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      /* Smaller table text on mobile */
      table {
        font-size: 0.85em;
      }

      th, td {
        padding: 8px;
      }

      /* Adjust section spacing */
      .section {
        margin-bottom: 25px;
      }

      .section-title {
        font-size: 1.4em;
      }
    }

    /* Even smaller screens */
    @media (max-width: 480px) {
      body {
        padding: 5px; /* Minimal background gap on very small screens */
      }

      .header h1 {
        font-size: 1.5em;
      }

      .header p {
        font-size: 0.95em;
      }

      .content {
        padding: 15px;
      }

      .summary-cards.summary-fixed {
        padding: 8px 10px !important; /* Even smaller padding */
      }

      .summary-card {
        padding: 12px;
      }

      .summary-value {
        font-size: 1.5em;
      }

      .summary-card h3 {
        font-size: 0.9em;
      }

      .summary-detail {
        font-size: 0.8em;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="summarySpacer"></div>
    <div class="header">
      <h1>üè¢ Vending Machine Profit Model</h1>
      <p>Comparative Financial Analysis: Bright.Blue vs Selecta</p>
    </div>

    <div class="content">
      <!-- Assumptions Section -->
      <div class="section">
        <h2 class="section-title">üìä Assumptions & Constants</h2>

        <h3 style="margin: 20px 0 15px 0; color: #555;">Revenue Assumptions</h3>
        <div class="grid">
          <div class="input-group">
            <label>Number of Machines</label>
            <input type="number" id="numMachines" value="30" min="1">
          </div>

          <div class="input-group">
            <label>Contract Term (Years)</label>
            <input type="number" id="contractYears" value="5" min="1">
          </div>
          <div class="input-group">
            <label>Machine Capital Cost</label>
            <input type="number" id="machineCost" value="10000" min="0">
          </div>
          <div class="input-group">
            <label>Monthly Maintenance Cost</label>
            <input type="number" id="maintenanceCost" value="25" min="0">
          </div>
          <div class="input-group" <label>Monthly Product Sales</label>
            <input type="number" id="productSales" value="800" min="0">
          </div>
          <div class="input-group">
            <label>Monthly Ad Revenue - BB Only</label>
            <input type="number" id="adRevenue" value="500" min="0">
          </div>
        </div>
      </div>

      <h3 style="margin: 20px 0 15px 0; color: #555;">Pricing Components (GBP)</h3>
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: #667eea; margin-bottom: 15px;">Selecta Pricing (¬£)</h4>
        <div class="grid">
          <div class="input-group">
            <label>Upfront Payment</label>
            <input type="number" id="selectaUpfront" value="4500" min="0">
          </div>
          <div class="input-group">
            <label>Technical Maintenance</label>
            <input type="number" id="selectaMaintenance" value="80" min="0">
          </div>
        </div>
      </div>

      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: #f093fb; margin-bottom: 15px;">Bright.Blue Pricing (¬£)</h4>
        <div class="grid">
          <div class="input-group">
            <label>Upfront Payment</label>
            <input type="number" id="brightblueUpfront" value="2500" min="0">
          </div>
          <div class="input-group">
            <label>Hardware-as-a-Service</label>
            <input type="number" id="brightblueHardware" value="230" min="0">
          </div>
          <div class="input-group">
            <label>Technical Maintenance</label>
            <input type="number" id="brightblueMaintenance" value="0" min="0">
          </div>
          <div class="input-group">
            <label>Platform Fee</label>
            <input type="number" id="brightbluePlatform" value="170" min="0">
          </div>
          <div class="input-group">
            <label>Retail Media Fee</label>
            <input type="number" id="brightblueRetail" value="0" min="0">
          </div>
          <div class="input-group">
            <label>Commerce Fee (%)</label>
            <input type="number" id="brightblueCommerce" value="5" min="0" max="100" step="0.1">
          </div>
        </div>
      </div>
    </div>

    <!-- Pricing Structure -->
    <div class="section">
      <h2 class="section-title">üí∞ Customer Pricing Structure (Per Machine)</h2>
      <div class="note">
        <strong>Important:</strong>
        ‚Ä¢ Bright.Blue receives no upfront payment but keeps 100% of all monthly fees as profit
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Revenue Component</th>
              <th class="number">Selecta<br><span style="font-weight: normal; font-size: 0.9em;">[Revenue -
                  Cost = Net Margin]</span></th>
              <th class="number">Bright.Blue<br><span style="font-weight: normal; font-size: 0.9em;">[100%
                  Margin]</span></th>
            </tr>
          </thead>
          <tbody id="pricingTable">
            <!-- Will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Projections -->
    <div class="section">
      <h2 class="section-title">üìà 5-Year Financial Projections</h2>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Financial Metric</th>
              <th class="number">Selecta</th>
              <th class="number">Bright.Blue</th>
              <th class="number">Difference</th>
            </tr>
          </thead>
          <tbody id="projectionsTable">
            <!-- Will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards" id="summaryCards">
      <!-- Will be populated by JavaScript -->
    </div>

    <button class="btn-calculate" onclick="calculateModel()">üîÑ Recalculate Model</button>
    
    <button class="btn-calculate" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="shareModel()">
      üìã Copy Shareable Link
    </button>

    <!-- Audit Trail Section -->
    <button class="btn-calculate" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"
      onclick="toggleAudit()">
      üìä Show/Hide Detailed Audit Trail
    </button>

    <div id="auditSection" style="display: none;">
      <div class="section">
        <h2 class="section-title">üîç Detailed Calculation Audit Trail</h2>

        <div class="note" style="background: #e3f2fd; border-left-color: #2196f3;">
          <strong>Audit Documentation:</strong> All calculations shown below demonstrate the exact formulas and
          computations used in this model.
        </div>

        <div id="auditContent">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>


    <script>
      // URL parameter handling
      function updateURLParams() {
        const params = new URLSearchParams();
        
        // Get all input values
        params.set('numMachines', document.getElementById('numMachines').value);
        params.set('contractYears', document.getElementById('contractYears').value);
        params.set('machineCost', document.getElementById('machineCost').value);
        params.set('maintenanceCost', document.getElementById('maintenanceCost').value);
        params.set('productSales', document.getElementById('productSales').value);
        params.set('adRevenue', document.getElementById('adRevenue').value);
        
        // Selecta pricing
        params.set('selectaUpfront', document.getElementById('selectaUpfront').value);
        params.set('selectaMaintenance', document.getElementById('selectaMaintenance').value);
        
        // Bright.Blue pricing
        params.set('brightblueUpfront', document.getElementById('brightblueUpfront').value);
        params.set('brightblueHardware', document.getElementById('brightblueHardware').value);
        params.set('brightblueMaintenance', document.getElementById('brightblueMaintenance').value);
        params.set('brightbluePlatform', document.getElementById('brightbluePlatform').value);
        params.set('brightblueRetail', document.getElementById('brightblueRetail').value);
        params.set('brightblueCommerce', document.getElementById('brightblueCommerce').value);
        
        // Update URL without reloading the page
        const newURL = window.location.pathname + '?' + params.toString();
        window.history.replaceState({}, '', newURL);
      }

      function loadURLParams() {
        const params = new URLSearchParams(window.location.search);
        
        // Load values from URL if they exist
        const paramMappings = [
          'numMachines', 'contractYears', 'machineCost', 'maintenanceCost', 
          'productSales', 'adRevenue', 'selectaUpfront', 'selectaMaintenance',
          'brightblueUpfront', 'brightblueHardware', 'brightblueMaintenance',
          'brightbluePlatform', 'brightblueRetail', 'brightblueCommerce'
        ];
        
        paramMappings.forEach(param => {
          if (params.has(param)) {
            const element = document.getElementById(param);
            if (element) {
              element.value = params.get(param);
            }
          }
        });
      }

      function shareModel() {
        // Update URL first to ensure it has the latest values
        updateURLParams();
        
        // Get the full URL
        const shareableURL = window.location.href;
        
        // Copy to clipboard
        navigator.clipboard.writeText(shareableURL).then(() => {
          // Show success message
          const button = event.target;
          const originalText = button.innerHTML;
          button.innerHTML = '‚úÖ Link Copied!';
          button.style.background = 'linear-gradient(135deg, #4caf50 0%, #8bc34a 100%)';
          
          // Reset button after 2 seconds
          setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
          }, 2000);
        }).catch(err => {
          alert('Failed to copy link. URL: ' + shareableURL);
        });
      }

      function toggleAudit() {
        const auditSection = document.getElementById('auditSection');
        auditSection.style.display = auditSection.style.display === 'none' ? 'block' : 'none';
      }

      function formatCurrency(value) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'GBP',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(value);
      }

      function formatPercent(value) {
        return value.toFixed(1) + '%';
      }

      // Pin summary cards to the top and align to the centered container
      function updateSummaryPosition() {
        const summary = document.getElementById('summaryCards');
        const spacer = document.getElementById('summarySpacer');
        const container = document.querySelector('.container');
        if (!summary || !spacer || !container) return;

        summary.classList.add('summary-fixed');

        const rect = container.getBoundingClientRect();
        summary.style.left = rect.left + 'px';
        summary.style.width = rect.width + 'px';
        summary.style.padding = '16px 20px';
        summary.style.boxSizing = 'border-box';

        // Reserve space so the fixed summary doesn't cover content
        const height = summary.getBoundingClientRect().height;
        const extra = 16; // extra breathing room
        spacer.style.height = (height + extra) + 'px';
      }

      function calculateModel() {
        // Check if all elements exist before proceeding
        if (!document.getElementById('numMachines')) return;
        
        // Update URL with current values
        updateURLParams();

        // Get input values
        const numMachines = parseFloat(document.getElementById('numMachines').value);
        const contractYears = parseFloat(document.getElementById('contractYears').value);
        const machineCost = parseFloat(document.getElementById('machineCost').value);
        const maintenanceCost = parseFloat(document.getElementById('maintenanceCost').value);
        const productSales = parseFloat(document.getElementById('productSales').value);
        const adRevenue = parseFloat(document.getElementById('adRevenue').value);

        // Get pricing component values (in GBP) with defaults
        const pricingStructure = {
          selecta: {
            activationFee: parseFloat(document.getElementById('selectaUpfront')?.value),
            hardwareService: parseFloat(document.getElementById('selectaHardware')?.value0 || 0),
            technicalMaintenance: parseFloat(document.getElementById('selectaMaintenance')?.value),
            platformFee: 0,
            retailMediaFee: 0,
            commerceFee: 0
          },
          brightBlue: {
            activationFee: parseFloat(document.getElementById('brightblueUpfront')?.value),
            hardwareService: parseFloat(document.getElementById('brightblueHardware')?.value),
            technicalMaintenance: parseFloat(document.getElementById('brightblueMaintenance')?.value),
            platformFee: parseFloat(document.getElementById('brightbluePlatform')?.value),
            retailMediaFee: parseFloat(document.getElementById('brightblueRetail')?.value),
            commerceFee: parseFloat(document.getElementById('brightblueCommerce')?.value)
          }
        };

        const selectaPricing = {
          activationFee: pricingStructure.selecta.activationFee,
          monthlyFees: (pricingStructure.selecta.hardwareService +
            pricingStructure.selecta.technicalMaintenance +
            pricingStructure.selecta.platformFee)
        };

        const brightBluePricing = {
          activationFee: pricingStructure.brightBlue.activationFee,
          monthlyFees: (pricingStructure.brightBlue.hardwareService +
            pricingStructure.brightBlue.technicalMaintenance +
            pricingStructure.brightBlue.platformFee +
            pricingStructure.brightBlue.retailMediaFee)
        };

        // Calculate revenues
        const monthsTotal = contractYears * 12;

        // Selecta calculations
        // Upfront payment is kept as profit, monthly fees are pass-through (net ¬£0)
        const selectaUpfrontRevenue = selectaPricing.activationFee * numMachines;
        const selectaMonthlyRevenue = selectaPricing.monthlyFees * monthsTotal * numMachines;
        const selectaMonthlyPassthroughCost = selectaMonthlyRevenue; // Pass-through cost equals revenue
        const selectaNetContractRevenue = selectaUpfrontRevenue; // Only upfront is profit
        const selectaProductRevenue = productSales * monthsTotal * numMachines;
        const selectaTotalRevenue = selectaNetContractRevenue + selectaProductRevenue;

        // Bright.Blue calculations
        // No upfront payment, but keeps all monthly fees as profit
        const brightBlueUpfrontRevenue = brightBluePricing.activationFee * numMachines; // ¬£0
        const brightBlueMonthlyRevenue = brightBluePricing.monthlyFees * monthsTotal * numMachines;
        const brightBlueCustomerRevenue = brightBlueUpfrontRevenue + brightBlueMonthlyRevenue;
        const brightBlueProductRevenue = productSales * monthsTotal * numMachines;
        const brightBlueAdRevenue = adRevenue * monthsTotal * numMachines;
        const brightBlueCommerceFee = brightBlueProductRevenue * (pricingStructure.brightBlue.commerceFee / 100);
        const brightBlueTotalRevenue = brightBlueCustomerRevenue + brightBlueProductRevenue + brightBlueAdRevenue + brightBlueCommerceFee;

        // Calculate costs
        const totalMachineCost = machineCost * numMachines;

        const totalMaintenanceCost = maintenanceCost * monthsTotal * numMachines;
        const productCost = productSales;

        // Total costs (same for both initially, but Bright.Blue has higher service costs)
        const selectaTotalCost = totalMaintenanceCost + productCost;
        const brightBlueTotalCost = totalMaintenanceCost + productCost;

        // Net profit (handle any NaN values)
        const selectaNetProfit = selectaTotalRevenue - selectaTotalCost;
        const brightBlueNetProfit = brightBlueTotalRevenue - brightBlueTotalCost;

        // Check for NaN values and return early if found
        if (isNaN(selectaNetProfit) || isNaN(brightBlueNetProfit)) {
          return;
        }

        // Variables already calculated above; proceed to render tables

        // Update pricing table with pass-through cost notation for Selecta
        const pricingTableHTML = `
                <tr>
                    <td>Upfront Payment (One-time)</td>
                    <td class="number" style="color: #4caf50; font-weight: bold;">${formatCurrency(selectaPricing.activationFee)} <span style="color: #4caf50;">(margin)</span></td>
                    <td class="number">${formatCurrency(brightBluePricing.activationFee)}</td>
                </tr>
                <tr>
                    <td>Hardware-as-a-Service</td>
                    <td class="number" style="color: #666;">${formatCurrency(pricingStructure.selecta.hardwareService)} (-${formatCurrency(pricingStructure.selecta.hardwareService)} cost) = <span style="color: #000;">¬£0</span></td>
                    <td class="number">${formatCurrency(pricingStructure.brightBlue.hardwareService)}</td>
                </tr>
                <tr>
                    <td>technical maintenance</td>
                    <td class="number" style="color: #666;">${formatCurrency(pricingStructure.selecta.technicalMaintenance)}</td>
                    <td class="number">${formatCurrency(pricingStructure.brightBlue.technicalMaintenance)}</td>
                </tr>
                <tr>
                    <td>Platform Fee</td>
                    <td class="number" style="color: #666;">n/a</td>
                    <td class="number">${formatCurrency(pricingStructure.brightBlue.platformFee)}</td>
                </tr>
                <tr>
                    <td>Retail Media Fee</td>
                    <td class="number" style="color: #666;">${formatCurrency(pricingStructure.selecta.retailMediaFee)} (-${formatCurrency(pricingStructure.selecta.retailMediaFee)} cost) = <span style="color: #000;">¬£0</span></td>
                    <td class="number">${formatCurrency(pricingStructure.brightBlue.retailMediaFee)}</td>
                </tr>
                <tr style="font-weight: bold; background: #f5f5f5;">
                    <td>Total Monthly Recurring</td>
                    <td class="number" style="color: #666;"><span style="color: #000;">${formatCurrency(selectaPricing.monthlyFees)}</td>
                    <td class="number">${formatCurrency(brightBluePricing.monthlyFees)}</td>
                </tr>
            `;
        document.getElementById('pricingTable').innerHTML = pricingTableHTML;

        // Update projections table
        const projectionsTableHTML = `
                <tr>
                    <td><strong>Revenue Streams</strong></td>
                    <td colspan="3"></td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Customer Contract Revenue (Net)</td>
                    <td class="number">${formatCurrency(selectaNetContractRevenue)}<br><span style="font-size: 0.85em; color: #666;">(Upfront margin only, monthly is pass-through)</span></td>
                    <td class="number">${formatCurrency(brightBlueCustomerRevenue)}<br><span style="font-size: 0.85em; color: #666;">(All monthly fees, no upfront)</span></td>
                    <td class="number ${brightBlueCustomerRevenue > selectaNetContractRevenue ? 'positive' : 'negative'}">
                        ${formatCurrency(brightBlueCustomerRevenue - selectaNetContractRevenue)}
                    </td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Product Sales Revenue</td>
                    <td class="number">${formatCurrency(selectaProductRevenue)}</td>
                    <td class="number">${formatCurrency(brightBlueProductRevenue)}</td>
                    <td class="number">${formatCurrency(0)}</td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Advertising Revenue</td>
                    <td class="number">${formatCurrency(0)}</td>
                    <td class="number">${formatCurrency(brightBlueAdRevenue)}</td>
                    <td class="number positive">${formatCurrency(brightBlueAdRevenue)}</td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Commerce Fee (5% of sales)</td>
                    <td class="number">${formatCurrency(0)}</td>
                    <td class="number">${formatCurrency(brightBlueCommerceFee)}</td>
                    <td class="number positive">${formatCurrency(brightBlueCommerceFee)}</td>
                </tr>
                <tr style="font-weight: bold; background: #e8f5e9;">
                    <td>Total Revenue</td>
                    <td class="number">${formatCurrency(selectaTotalRevenue)}</td>
                    <td class="number">${formatCurrency(brightBlueTotalRevenue)}</td>
                    <td class="number positive">${formatCurrency(brightBlueTotalRevenue - selectaTotalRevenue)}</td>
                </tr>
                <tr>
                    <td><strong>Operating Costs</strong></td>
                    <td colspan="3"></td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Maintenance & Operations</td>
                    <td class="number">${formatCurrency(totalMaintenanceCost)}</td>
                    <td class="number">${formatCurrency(totalMaintenanceCost)}</td>
                    <td class="number">${formatCurrency(0)}</td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">Product Cost (COGS)</td>
                    <td class="number">${formatCurrency(productCost)}</td>
                    <td class="number">${formatCurrency(productCost)}</td>
                    <td class="number">${formatCurrency(0)}</td>
                </tr>
                <tr style="font-weight: bold; background: #ffebee;">
                    <td>Total Costs</td>
                    <td class="number">${formatCurrency(selectaTotalCost)}</td>
                    <td class="number">${formatCurrency(brightBlueTotalCost)}</td>
                    <td class="number">${formatCurrency(brightBlueTotalCost - selectaTotalCost)}</td>
                </tr>
                <tr style="font-weight: bold; font-size: 1.1em; background: #f3e5f5;">
                    <td>NET PROFIT</td>
                    <td class="number ${selectaNetProfit > 0 ? 'positive' : 'negative'}">${formatCurrency(selectaNetProfit)}</td>
                    <td class="number ${brightBlueNetProfit > 0 ? 'positive' : 'negative'}">${formatCurrency(brightBlueNetProfit)}</td>
                    <td class="number ${brightBlueNetProfit > selectaNetProfit ? 'positive' : 'negative'}">
                        ${formatCurrency(brightBlueNetProfit - selectaNetProfit)}
                    </td>
                </tr>
                <tr>
                    <td>Profit Margin</td>
                    <td class="number">${selectaTotalRevenue > 0 ? formatPercent((selectaNetProfit / selectaTotalRevenue) * 100) : 'N/A'}</td>
                    <td class="number">${brightBlueTotalRevenue > 0 ? formatPercent((brightBlueNetProfit / brightBlueTotalRevenue) * 100) : 'N/A'}</td>
                    <td class="number">-</td>
                </tr>
                <tr>
                    <td>ROI (Return on Investment)</td>
                    <td class="number">${totalMachineCost > 0 ? formatPercent((selectaNetProfit / totalMachineCost) * 100) : 'N/A'}</td>
                    <td class="number">${totalMachineCost > 0 ? formatPercent((brightBlueNetProfit / totalMachineCost) * 100) : 'N/A'}</td>
                    <td class="number">-</td>
                </tr>
            `;
        document.getElementById('projectionsTable').innerHTML = projectionsTableHTML;

        // Update summary cards
        const summaryCardsHTML = `
                <div class="summary-card" style="background: linear-gradient(135deg, #8892c7 0%, #8e6ba8 100%);">
                    <h3>Selecta Total Profit</h3>
                    <div class="summary-value">${formatCurrency(selectaNetProfit)}</div>
                    <div class="summary-detail">Margin: ${selectaTotalRevenue > 0 ? formatPercent((selectaNetProfit / selectaTotalRevenue) * 100) : 'N/A'}</div>
                    <div class="summary-detail">Per Machine: ${formatCurrency(selectaNetProfit / numMachines)}</div>
                </div>
                <div class="summary-card" style="background: linear-gradient(135deg, #d4b0d7 0%, #d18994 100%);">
                    <h3>Bright.Blue Total Profit</h3>
                    <div class="summary-value">${formatCurrency(brightBlueNetProfit)}</div>
                    <div class="summary-detail">Margin: ${brightBlueTotalRevenue > 0 ? formatPercent((brightBlueNetProfit / brightBlueTotalRevenue) * 100) : 'N/A'}</div>
                    <div class="summary-detail">Per Machine: ${formatCurrency(brightBlueNetProfit / numMachines)}</div>
                </div>
                <div class="summary-card shimmer-card">
                    <h3>‚≠ê Additional Profit ‚≠ê</h3>
                    <div class="summary-value">${formatCurrency(brightBlueNetProfit - selectaNetProfit)}</div>
                    <div class="summary-detail">üöÄ Improvement: ${selectaNetProfit > 0 ? formatPercent(((brightBlueNetProfit - selectaNetProfit) / Math.abs(selectaNetProfit)) * 100) : 'N/A'}</div>
                    <div class="summary-detail">üí∞ Per Machine: ${formatCurrency((brightBlueNetProfit - selectaNetProfit) / numMachines)}</div>
                </div>
            `;
        document.getElementById('summaryCards').innerHTML = summaryCardsHTML;

        // After rendering, recalc floating summary sizing/position
        updateSummaryPosition();


        // Generate Audit Trail Content
        const auditHTML = `
                <div class="calculation-grid">
                    <div class="calc-box">
                        <h5>üìê SELECTA CALCULATIONS</h5>
                        <div class="calc-line">
                            <span>Number of Machines:</span>
                            <span>${numMachines}</span>
                        </div>
                        <div class="calc-line">
                            <span>Contract Term:</span>
                            <span>${contractYears} years (${monthsTotal} months)</span>
                        </div>
                    </div>
                    <div class="calc-box">
                        <h5>üìê BRIGHT.BLUE CALCULATIONS</h5>
                        <div class="calc-line">
                            <span>Number of Machines:</span>
                            <span>${numMachines}</span>
                        </div>
                        <div class="calc-line">
                            <span>Contract Term:</span>
                            <span>${contractYears} years (${monthsTotal} months)</span>
                        </div>
                    </div>
                </div>
                
                <div class="audit-table">
                    <h4>1Ô∏è‚É£ REVENUE CALCULATIONS</h4>
                    
                    <div class="calculation-grid">
                        <div class="calc-box">
                            <h5>Selecta Revenue Components</h5>
                            <div class="formula">
                                <strong>Customer Contract Revenue:</strong><br>
                                <span style="color: #4caf50; font-weight: bold;">Upfront Payment: ¬£${pricingStructure.selecta.activationFee} √ó ${numMachines} = ${formatCurrency(selectaPricing.activationFee * numMachines)} (margin contribution)</span><br>
                                <br>
                                Monthly Fees: ¬£${pricingStructure.selecta.hardwareService + pricingStructure.selecta.technicalMaintenance + pricingStructure.selecta.platformFee}/mo √ó ${monthsTotal} mo √ó ${numMachines} machines<br>
                                = ${formatCurrency(selectaPricing.monthlyFees)}/mo √ó ${monthsTotal} √ó ${numMachines}<br>
                                = ${formatCurrency(selectaPricing.monthlyFees * monthsTotal * numMachines)}<br>
                                <span style="color: #d32f2f;">Less: Pass-through costs = -${formatCurrency(selectaPricing.monthlyFees * monthsTotal * numMachines)}</span><br>
                                <strong>Net Contract Revenue = ${formatCurrency(selectaPricing.activationFee * numMachines)} (upfront margin)</strong>
                            </div>
                            
                            <div class="formula">
                                <strong>Product Sales Revenue:</strong><br>
                                ${productSales}/mo √ó ${monthsTotal} months √ó ${numMachines} machines<br>
                                = <strong>${formatCurrency(selectaProductRevenue)}</strong>
                            </div>
                            
                            <div class="formula">
                                <strong>Total Selecta Revenue:</strong><br>
                                Customer Contract (Net): ${formatCurrency(selectaNetContractRevenue)}<br>
                                Product Sales: ${formatCurrency(selectaProductRevenue)}<br>
                                = <strong>${formatCurrency(selectaTotalRevenue)}</strong>
                            </div>
                        </div>
                        
                        <div class="calc-box">
                            <h5>Bright.Blue Revenue Components</h5>
                            <div class="formula">
                                <strong>Customer Contract Revenue (100% margin):</strong><br>
                                <span style="color: #999;">Upfront Payment: ¬£0 √ó ${numMachines} = ¬£0 (no upfront payment)</span><br>
                                <br>
                                Monthly Fees: ¬£${pricingStructure.brightBlue.hardwareService + pricingStructure.brightBlue.technicalMaintenance + pricingStructure.brightBlue.platformFee + pricingStructure.brightBlue.retailMediaFee}/mo √ó ${monthsTotal} mo √ó ${numMachines} machines<br>
                                = ${formatCurrency(brightBluePricing.monthlyFees)}/mo √ó ${monthsTotal} √ó ${numMachines}<br>
                                = <strong>${formatCurrency(brightBluePricing.monthlyFees * monthsTotal * numMachines)}</strong><br>
                                <span style="color: #4caf50;">No underlying costs = 100% margin on all monthly fees</span>
                            </div>
                            
                            <div class="formula">
                                <strong>Product Sales Revenue:</strong><br>
                                ${productSales}/mo √ó ${monthsTotal} months √ó ${numMachines} machines<br>
                                = <strong>${formatCurrency(brightBlueProductRevenue)}</strong>
                            </div>
                            
                            <div class="formula">
                                <strong>Advertising Revenue:</strong><br>
                                ${adRevenue}/mo √ó ${monthsTotal} months √ó ${numMachines} machines<br>
                                = <strong>${formatCurrency(brightBlueAdRevenue)}</strong>
                            </div>
                            
                            <div class="formula">
                                <strong>Commerce Fee (5% of sales):</strong><br>
                                ${formatCurrency(brightBlueProductRevenue)} √ó ${pricingStructure.brightBlue.commerceFee}%<br>
                                = <strong>${formatCurrency(brightBlueCommerceFee)}</strong>
                            </div>
                            
                            <div class="formula">
                                <strong>Total Bright.Blue Revenue:</strong><br>
                                ${formatCurrency(brightBlueCustomerRevenue)} + ${formatCurrency(brightBlueProductRevenue)} + ${formatCurrency(brightBlueAdRevenue)} + ${formatCurrency(brightBlueCommerceFee)}<br>
                                = <strong>${formatCurrency(brightBlueTotalRevenue)}</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="audit-table">
                    <h4>2Ô∏è‚É£ COST CALCULATIONS</h4>
                    
                    <div class="formula">
                        <strong>Maintenance & Operations:</strong><br>
                        ${maintenanceCost}/mo √ó ${monthsTotal} months √ó ${numMachines} machines<br>
                        = <strong>${formatCurrency(totalMaintenanceCost)}</strong>
                    </div>
                    
                    <div class="formula">
                        Product Sales: ${formatCurrency(productSales * numMachines)}<br>
                    </div>
                    
                    <div class="formula">
                        <strong>Total Operating Costs (both companies):</strong><br>
                        ${formatCurrency(totalMaintenanceCost)} + ${formatCurrency(productCost)}<br>
                        = <strong>${formatCurrency(selectaTotalCost)}</strong>
                    </div>
                </div>
                
                <div class="audit-table">
                    <h4>3Ô∏è‚É£ NET PROFIT CALCULATIONS</h4>
                    
                    <div class="calculation-grid">
                        <div class="calc-box">
                            <h5>Selecta Net Profit</h5>
                            <div class="formula">
                                Total Revenue: ${formatCurrency(selectaTotalRevenue)}<br>
                                Less: Total Costs: ${formatCurrency(selectaTotalCost)}<br>
                                <strong>Net Profit: ${formatCurrency(selectaNetProfit)}</strong><br>
                                <br>
                                Profit Margin: ${selectaTotalRevenue > 0 ? `${formatCurrency(selectaNetProfit)} √∑ ${formatCurrency(selectaTotalRevenue)} = <strong>${((selectaNetProfit / selectaTotalRevenue) * 100).toFixed(1)}%</strong>` : 'N/A'}<br>
                                ROI: ${totalMachineCost > 0 ? `${formatCurrency(selectaNetProfit)} √∑ ${formatCurrency(totalMachineCost)} = <strong>${((selectaNetProfit / totalMachineCost) * 100).toFixed(1)}%</strong>` : 'N/A'}<br>
                                Per Machine Profit: ${numMachines > 0 ? `${formatCurrency(selectaNetProfit)} √∑ ${numMachines} = <strong>${formatCurrency(selectaNetProfit / numMachines)}</strong>` : 'N/A'}
                            </div>
                        </div>
                        
                        <div class="calc-box">
                            <h5>Bright.Blue Net Profit</h5>
                            <div class="formula">
                                Total Revenue: ${formatCurrency(brightBlueTotalRevenue)}<br>
                                Less: Total Costs: ${formatCurrency(brightBlueTotalCost)}<br>
                                <strong>Net Profit: ${formatCurrency(brightBlueNetProfit)}</strong><br>
                                <br>
                                Profit Margin: ${brightBlueTotalRevenue > 0 ? `${formatCurrency(brightBlueNetProfit)} √∑ ${formatCurrency(brightBlueTotalRevenue)} = <strong>${((brightBlueNetProfit / brightBlueTotalRevenue) * 100).toFixed(1)}%</strong>` : 'N/A'}<br>
                                ROI: ${totalMachineCost > 0 ? `${formatCurrency(brightBlueNetProfit)} √∑ ${formatCurrency(totalMachineCost)} = <strong>${((brightBlueNetProfit / totalMachineCost) * 100).toFixed(1)}%</strong>` : 'N/A'}<br>
                                Per Machine Profit: ${numMachines > 0 ? `${formatCurrency(brightBlueNetProfit)} √∑ ${numMachines} = <strong>${formatCurrency(brightBlueNetProfit / numMachines)}</strong>` : 'N/A'}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="audit-table">
                    <h4>4Ô∏è‚É£ COMPARATIVE ANALYSIS</h4>
                    
                    <div class="formula">
                        <strong>Additional Profit with Bright.Blue:</strong><br>
                        Bright.Blue Profit: ${formatCurrency(brightBlueNetProfit)}<br>
                        Less: Selecta Profit: ${formatCurrency(selectaNetProfit)}<br>
                        = <strong>${formatCurrency(brightBlueNetProfit - selectaNetProfit)}</strong> additional profit<br>
                        <br>
                        <strong>Percentage Improvement:</strong><br>
                        ${selectaNetProfit !== 0 ? `(${formatCurrency(brightBlueNetProfit - selectaNetProfit)} √∑ ${formatCurrency(Math.abs(selectaNetProfit))}) √ó 100 = <strong>${(((brightBlueNetProfit - selectaNetProfit) / Math.abs(selectaNetProfit)) * 100).toFixed(1)}%</strong> improvement` : 'N/A (Selecta profit is 0)'}<br>
                        <br>
                        <strong>Monthly Profit Comparison:</strong><br>
                        Selecta: ${monthsTotal > 0 ? `${formatCurrency(selectaNetProfit)} √∑ ${monthsTotal} months = <strong>${formatCurrency(selectaNetProfit / monthsTotal)}/month</strong>` : 'N/A'}<br>
                        Bright.Blue: ${monthsTotal > 0 ? `${formatCurrency(brightBlueNetProfit)} √∑ ${monthsTotal} months = <strong>${formatCurrency(brightBlueNetProfit / monthsTotal)}/month</strong>` : 'N/A'}
                    </div>
                </div>
                
                <div class="audit-table" style="background: #e8f5e9;">
                    <h4>‚úÖ AUDIT VERIFICATION</h4>
                    <div class="formula">
                        <strong>Balance Check - Selecta:</strong><br>
                        Revenue (${formatCurrency(selectaTotalRevenue)}) - Costs (${formatCurrency(selectaTotalCost)}) = ${formatCurrency(selectaNetProfit)} ‚úì<br>
                        <br>
                        <strong>Balance Check - Bright.Blue:</strong><br>
                        Revenue (${formatCurrency(brightBlueTotalRevenue)}) - Costs (${formatCurrency(brightBlueTotalCost)}) = ${formatCurrency(brightBlueNetProfit)} ‚úì<br>
                        <br>
                        <strong>Equipment Cost Recovery:</strong><br>
                        ‚Ä¢ Selecta upfront payment: ${formatCurrency(selectaPricing.activationFee * numMachines)} (${((selectaPricing.activationFee * numMachines / totalMachineCost) * 100).toFixed(1)}% of equipment cost)<br>
                        ‚Ä¢ Bright.Blue upfront: $0 (0% of equipment cost)<br>
                        <br>
                        <strong>Time Period:</strong> ${contractYears} years = ${monthsTotal} months<br>
                        <strong>Machine Count:</strong> ${numMachines} units<br>
                    </div>
                </div>
            `;

        document.getElementById('auditContent').innerHTML = auditHTML;
      }

      // Initial calculation on page load
      document.addEventListener('DOMContentLoaded', function () {
        // Load parameters from URL first
        loadURLParams();
        
        // Initial calculation
        calculateModel();
        updateSummaryPosition();
        window.addEventListener('resize', updateSummaryPosition);

        // Add event listeners for real-time updates to all input elements
        document.querySelectorAll('input').forEach(input => {
          input.addEventListener('input', calculateModel);
        });

        // Add dynamic animation to the shimmer card
        setInterval(() => {
          const shimmerCard = document.querySelector('.shimmer-card');
          if (shimmerCard) {
            // Add a brief highlight effect
            shimmerCard.style.transition = 'all 0.5s ease';
            shimmerCard.style.filter = 'brightness(1.2) contrast(1.1)';
            shimmerCard.style.transform = 'scale(1.03)';

            setTimeout(() => {
              shimmerCard.style.filter = 'brightness(1) contrast(1)';
              shimmerCard.style.transform = 'scale(1)';
            }, 500);
          }
        }, 3000);
      });
    </script>
</body>

</html>